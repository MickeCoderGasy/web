# Troubleshooting Guide

## AI Market Insights - "Unable to load AI insights"

If you're seeing this error when selecting a currency pair, here are the steps to diagnose and fix the issue:

### 1. Check Browser Console

Open your browser's Developer Tools (F12) and check the Console tab for detailed error messages:

```
Fetching AI insight for pair: USD/JPY
Supabase response: { data: null, error: { code: 'PGRST116', message: '...' } }
```

### 2. Common Error Codes

#### PGRST116 - No Rows Found
**Error**: `No analysis found for USD/JPY. The database may not have been updated yet for this pair.`

**Solution**:
- The database exists but doesn't have data for this specific pair yet
- Wait for the hourly auto-refresh to populate data
- Try selecting a different currency pair (EUR/USD, GBP/USD, etc.)

#### PGRST301 - Table Not Found
**Error**: `relation "public.news and events" does not exist`

**Solution**:
1. Go to your Supabase dashboard
2. Navigate to SQL Editor
3. Run this SQL command:

```sql
create table public."news and events" (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  pair text null,
  content text null,
  constraint "news and events_pkey" primary key (id)
);

-- Enable Row Level Security
alter table public."news and events" enable row level security;

-- Create policy to allow authenticated users to read
create policy "Allow authenticated users to read insights"
  on public."news and events"
  for select
  to authenticated
  using (true);
```

#### 42P01 - Invalid Table Name
**Error**: `relation "news_and_events" does not exist`

**Cause**: The table name has a space and must be referenced with quotes

**Solution**: Already handled in the code with `'news and events'` (with space)

### 3. Verify Table Exists

Run this query in Supabase SQL Editor:

```sql
SELECT * FROM "news and events" LIMIT 5;
```

You should see results like:
```
id | created_at              | pair    | content
---+-------------------------+---------+----------
1  | 2025-10-14 10:00:00+00  | EUR/USD | ---\n**Rapport...
2  | 2025-10-14 10:00:00+00  | USD/JPY | ---\n**Rapport...
```

### 4. Check Data for Specific Pair

```sql
SELECT pair, created_at, length(content) as content_length 
FROM "news and events" 
WHERE pair = 'USD/JPY'
ORDER BY created_at DESC
LIMIT 1;
```

If this returns 0 rows, the database hasn't been populated for USD/JPY yet.

### 5. Verify Row Level Security (RLS)

Check if RLS policies are configured correctly:

```sql
-- Check if RLS is enabled
SELECT tablename, rowsecurity 
FROM pg_tables 
WHERE tablename = 'news and events';

-- Check existing policies
SELECT * FROM pg_policies 
WHERE tablename = 'news and events';
```

### 6. Manual Data Insert (For Testing)

If you want to test with sample data:

```sql
INSERT INTO "news and events" (pair, content)
VALUES (
  'USD/JPY',
  '---
**Rapport d''Analyse pour USD/JPY**

**1. Synthèse Clé :**
Test analysis for USD/JPY...

**2. Événements Économiques à Surveiller (Prochaines 48h) :**
* Test events...

**3. Analyse des Nouvelles Récentes (Dernières 24h) :**
* Test news...

**4. Insight Actionnable pour l''Agent de Signal :**
* Test recommendations...
---'
);
```

### 7. Check Authentication

Make sure you're logged in:
- The user should be authenticated via Supabase
- Check if `user` and `token` exist in the AuthContext
- Try logging out and logging back in

### 8. Network Issues

Check the Network tab in Developer Tools:
- Look for requests to Supabase
- Check for CORS errors
- Verify the response status codes

### 9. Environment Variables

Verify your `.env` file has correct Supabase credentials:

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your-anon-key
```

### 10. Common Solutions Checklist

- [ ] Table `"news and events"` exists in Supabase
- [ ] Table has data for at least one currency pair
- [ ] RLS policies allow authenticated users to read
- [ ] User is logged in (check AuthContext)
- [ ] Environment variables are set correctly
- [ ] Browser console shows detailed error messages
- [ ] No CORS or network errors

## Market News - Not Loading

### Check Webhook

The news service calls: `https://n8n.qubextai.tech/webhook/Rss`

**Verify**:
1. Open browser console
2. Look for POST request to the webhook
3. Check response status and data

**Common Issues**:
- Webhook is down → Contact backend team
- Token is invalid → Try re-logging in
- Network timeout → Check internet connection

## Authentication Issues

### Cannot Login

1. **Check Supabase Dashboard**:
   - Go to Authentication > Users
   - Verify your email exists

2. **Email Verification**:
   - Check if email confirmation is required
   - Look for confirmation email in spam folder

3. **Wrong Credentials**:
   - Password must be at least 6 characters
   - Email must be valid format

### Session Lost

If you keep getting logged out:
1. Clear browser localStorage
2. Log out completely
3. Log back in
4. Check browser console for errors

## Still Having Issues?

If none of these solutions work:

1. **Export Console Logs**:
   - Right-click in console
   - Save as file
   
2. **Check Supabase Logs**:
   - Go to Supabase Dashboard
   - Navigate to Logs > Postgres Logs
   
3. **Contact Support**:
   - Provide console logs
   - Provide Supabase error codes
   - Specify which currency pair you're trying to view

## Debugging Commands

Open browser console and run:

```javascript
// Check auth status
console.log('User:', supabase.auth.getUser());

// Test direct query
const { data, error } = await supabase
  .from('news and events')
  .select('pair, created_at')
  .limit(10);
console.log('Available pairs:', data?.map(d => d.pair));

// Check for USD/JPY specifically
const { data: usdJpy, error: err } = await supabase
  .from('news and events')
  .select('*')
  .eq('pair', 'USD/JPY')
  .order('created_at', { ascending: false })
  .limit(1);
console.log('USD/JPY data:', usdJpy, 'Error:', err);
```

